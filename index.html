import React, { useState, useEffect } from 'react';
import { Calendar, Clock, Moon, Sun, Flower, ChevronRight } from 'lucide-react';

const EVENTS_DATA = [
  {
    date: '2026-01-10',
    title: 'Sesha Vahana Pooja',
    time: 'Evening 7:30 PM - 8:30 PM',
    description: 'Special pooja with Sesha Vahana darshan.',
    type: 'pooja'
  },
  {
    date: '2026-01-15',
    title: 'Makaram 1 (Pongal Naivadyam)',
    time: 'Morning',
    description: 'Celebration of Makara Sankranti with Pongal offering.',
    type: 'festival'
  },
  {
    date: '2026-01-16',
    title: 'Lakshmi Pooja',
    time: 'Evening 7:30 PM - 8:30 PM',
    description: 'Special prayers dedicated to Goddess Lakshmi.',
    type: 'pooja'
  },
  {
    date: '2026-01-18',
    title: 'Amavasi (Brahman)',
    time: 'Noon Time',
    description: 'Amavasya rituals and offerings.',
    type: 'ritual'
  }
];

export default function App() {
  const [status, setStatus] = useState('loading'); // 'today', 'upcoming', 'none', 'loading'
  const [displayEvent, setDisplayEvent] = useState(null);
  const [currentTime, setCurrentTime] = useState(new Date());

  // Helper to format dates nicely
  const formatDate = (dateString) => {
    const [year, month, day] = dateString.split('-').map(Number);
    // Create date using local time constructor
    const date = new Date(year, month - 1, day);
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-IN', options);
  };

  // Helper to get relative time (e.g., "In 2 days")
  const getRelativeTime = (dateString) => {
    const [year, month, day] = dateString.split('-').map(Number);
    const eventDate = new Date(year, month - 1, day);
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    eventDate.setHours(0, 0, 0, 0);
    
    const diffTime = eventDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Tomorrow';
    return `In ${diffDays} days`;
  };

  useEffect(() => {
    // Timer for the clock
    const timer = setInterval(() => setCurrentTime(new Date()), 1000);
    
    // Logic to find the correct event
    const checkEvents = () => {
      const today = new Date();
      // Construct local YYYY-MM-DD string manually to avoid UTC conversion issues
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const todayString = `${year}-${month}-${day}`;
      
      // 1. Check for Today's Event
      const todaysEvent = EVENTS_DATA.find(e => e.date === todayString);
      
      if (todaysEvent) {
        setStatus('today');
        setDisplayEvent(todaysEvent);
        return;
      }

      // 2. Check for Upcoming Event
      // Simple string comparison works because dates are YYYY-MM-DD and we are using local time for both
      const futureEvents = EVENTS_DATA.filter(e => e.date > todayString);

      if (futureEvents.length > 0) {
        // Sort by date just in case data isn't sorted
        futureEvents.sort((a, b) => a.date.localeCompare(b.date));
        setStatus('upcoming');
        setDisplayEvent(futureEvents[0]);
      } else {
        setStatus('none');
      }
    };

    checkEvents();

    return () => clearInterval(timer);
  }, []);

  const getIcon = (type) => {
    if (type === 'festival') return <Sun className="w-8 h-8 text-orange-500" />;
    if (type === 'ritual') return <Moon className="w-8 h-8 text-indigo-400" />;
    return <Flower className="w-8 h-8 text-pink-500" />;
  };

  return (
    <div className="min-h-screen bg-stone-50 font-sans text-stone-800 flex flex-col items-center pt-8 px-4">
      
      <main className="w-full max-w-md flex flex-col gap-6">
        
        {/* Date Only Display - Simplified */}
        <div className="text-center mb-4">
           <div className="text-stone-400 text-xs font-bold uppercase tracking-widest mb-2">Today's Date</div>
           <h1 className="text-3xl font-bold text-stone-800">
             {currentTime.toLocaleDateString('en-IN', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}
           </h1>
        </div>

        {/* Main Status Card */}
        {status === 'today' && displayEvent && (
          <div className="animate-fade-in">
            <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-l-4 border-orange-500 rounded-xl shadow-md p-6 relative overflow-hidden">
              <div className="absolute top-0 right-0 p-4 opacity-10">
                <Flower className="w-24 h-24 text-orange-600" />
              </div>
              
              <div className="relative z-10">
                <span className="inline-block bg-orange-100 text-orange-800 text-xs font-bold px-2 py-1 rounded-full mb-3 border border-orange-200">
                  HAPPENING TODAY
                </span>
                <h2 className="text-2xl font-bold text-red-800 mb-2 leading-tight">{displayEvent.title}</h2>
                
                <div className="flex items-center gap-2 text-stone-700 font-medium mb-4">
                  <Clock className="w-4 h-4" />
                  {displayEvent.time}
                </div>
                
                <p className="text-stone-600 text-sm italic bg-white/60 p-3 rounded-lg border border-stone-100">
                  "{displayEvent.description}"
                </p>
              </div>
            </div>
          </div>
        )}

        {status === 'upcoming' && displayEvent && (
          <div className="animate-fade-in">
             <div className="bg-white rounded-xl shadow-md p-6 border border-stone-100">
              <div className="flex justify-between items-start mb-4">
                <div>
                   <span className="inline-block bg-blue-50 text-blue-700 text-xs font-bold px-2 py-1 rounded-full mb-2">
                    NEXT EVENT
                  </span>
                  <div className="text-stone-400 text-xs uppercase tracking-wide font-semibold">
                    {getRelativeTime(displayEvent.date)}
                  </div>
                </div>
                <div className="bg-stone-50 p-2 rounded-full">
                  {getIcon(displayEvent.type)}
                </div>
              </div>
              
              <h2 className="text-xl font-bold text-stone-800 mb-1">{displayEvent.title}</h2>
              <div className="text-orange-700 font-medium mb-4 text-sm">{formatDate(displayEvent.date)}</div>

              <div className="flex items-center gap-2 text-stone-600 text-sm mb-3 bg-stone-50 p-2 rounded-lg">
                <Clock className="w-4 h-4 text-stone-400" />
                {displayEvent.time}
              </div>
              <p className="text-stone-500 text-sm leading-relaxed">
                {displayEvent.description}
              </p>
            </div>
          </div>
        )}

        {status === 'none' && (
           <div className="bg-white rounded-xl shadow-sm p-8 text-center border border-stone-100">
              <div className="mx-auto w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mb-4">
                <Calendar className="w-8 h-8 text-stone-400" />
              </div>
              <h3 className="text-lg font-bold text-stone-700 mb-2">No Upcoming Events</h3>
              <p className="text-stone-500 text-sm">There are no special events scheduled in the immediate calendar.</p>
           </div>
        )}

        {/* Full Schedule List */}
        <div className="mt-4">
          <h3 className="text-sm font-bold text-stone-500 uppercase tracking-wider mb-3 px-1">Full January Schedule</h3>
          <div className="bg-white rounded-xl shadow-sm border border-stone-100 divide-y divide-stone-100">
            {EVENTS_DATA.map((event, index) => {
              // Highlight if it is the main displayed event
              const isHighlighted = displayEvent && displayEvent.date === event.date;
              // Parse date locally for list display
              const [y, m, d] = event.date.split('-').map(Number);
              const dateObj = new Date(y, m - 1, d);

              return (
                <div 
                  key={index} 
                  className={`p-4 flex gap-4 items-center ${isHighlighted ? 'bg-orange-50/50' : 'hover:bg-stone-50'} transition-colors`}
                >
                  <div className="flex flex-col items-center justify-center bg-stone-100 w-12 h-12 rounded-lg shrink-0 border border-stone-200">
                    <span className="text-xs font-bold text-stone-500">{dateObj.toLocaleString('default', { month: 'short' })}</span>
                    <span className="text-lg font-bold text-stone-800 leading-none">{dateObj.getDate()}</span>
                  </div>
                  <div className="flex-1 min-w-0">
                    <h4 className={`font-semibold text-sm truncate ${isHighlighted ? 'text-orange-900' : 'text-stone-800'}`}>
                      {event.title}
                    </h4>
                    <p className="text-xs text-stone-500 truncate">{event.time}</p>
                  </div>
                  {isHighlighted && <ChevronRight className="w-4 h-4 text-orange-400" />}
                </div>
              );
            })}
          </div>
        </div>
        
      </main>
    </div>
  );
}


